---
export interface Props {
    mode: 'create' | 'edit';
    proposalData?: any;
    formId: string;
    readOnly?: boolean;
}

const { mode, proposalData, formId, readOnly = false } = Astro.props;
---

{readOnly ? (
    <!-- Vista de Solo Lectura -->
    <div class="proposal-form-readonly">
        <!-- Informaci√≥n B√°sica del Proyecto -->
        <div class="form-section">
            <h3>üìã Informaci√≥n B√°sica del Proyecto</h3>
            <div class="form-row">
                <div class="form-group">
                    <label>Nombre del Proyecto *</label>
                    <div class="readonly-value">{proposalData?.nombre_proyecto || 'No especificado'}</div>
                </div>
                <div class="form-group">
                    <label>Fecha de Propuesta *</label>
                    <div class="readonly-value">{proposalData?.fecha_propuesta || 'No especificada'}</div>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>Nombre del Cliente *</label>
                    <div class="readonly-value">{proposalData?.cliente_nombre || 'No especificado'}</div>
                </div>
                <div class="form-group">
                    <label>Empresa del Cliente *</label>
                    <div class="readonly-value">{proposalData?.cliente_empresa || 'No especificada'}</div>
                </div>
            </div>
        </div>

        <!-- Resumen Ejecutivo -->
        <div class="form-section">
            <h3>üìä Resumen Ejecutivo</h3>
            <div class="form-group">
                <label>Descripci√≥n del proyecto y propuesta de valor *</label>
                <div class="readonly-value">{proposalData?.resumen_ejecutivo || 'No especificado'}</div>
            </div>
        </div>

        <!-- Objetivos y Alcance -->
        <div class="form-section">
            <h3>üéØ Objetivos & Alcance</h3>
            <div class="form-group">
                <label>Objetivos espec√≠ficos y alcance del trabajo *</label>
                <div class="readonly-value">{proposalData?.objetivos_alcance || 'No especificado'}</div>
            </div>
        </div>

        <!-- Servicios -->
        <div class="form-section">
            <h3>üõ†Ô∏è Servicios Incluidos</h3>
            <div class="form-group">
                <label>Servicios seleccionados</label>
                <div class="readonly-value">
                    {proposalData?.servicios_seleccionados && Array.isArray(proposalData.servicios_seleccionados) ? 
                        proposalData.servicios_seleccionados.join(', ') : 'No especificados'}
                </div>
            </div>
        </div>

        <!-- Entregables -->
        <div class="form-section">
            <h3>üì¶ Entregables</h3>
            <div class="form-group">
                <label>Entregables del proyecto</label>
                <div class="readonly-value">
                    {proposalData?.entregables && Array.isArray(proposalData.entregables) ? 
                        proposalData.entregables.map((entregable: string) => <div class="deliverable-item-readonly">‚Ä¢ {entregable}</div>) :
                        <div>No especificados</div>}
                </div>
            </div>
        </div>

        <!-- Propuesta Econ√≥mica -->
        <div class="form-section">
            <h3>üí∞ Propuesta Econ√≥mica</h3>
            <div class="form-row">
                <div class="form-group">
                    <label>Valor del Proyecto *</label>
                    <div class="readonly-value">{proposalData?.valor_proyecto || 'No especificado'}</div>
                </div>
            </div>
            <div class="form-group">
                <label>Condiciones de Pago *</label>
                <div class="readonly-value">{proposalData?.terminos_pago || 'No especificadas'}</div>
            </div>
        </div>

        <!-- Informaci√≥n de Contacto -->
        <div class="form-section">
            <h3>üìû Informaci√≥n de Contacto</h3>
            <div class="form-row">
                <div class="form-group">
                    <label>Email de Contacto</label>
                    <div class="readonly-value">{proposalData?.contacto_email || 'No especificado'}</div>
                </div>
                <div class="form-group">
                    <label>WhatsApp</label>
                    <div class="readonly-value">{proposalData?.contacto_whatsapp || 'No especificado'}</div>
                </div>
            </div>
        </div>

        <!-- Texto Introductorio -->
        <div class="form-section">
            <h3>üìù Texto Introductorio</h3>
            <div class="form-group">
                <label>Texto introductorio de la propuesta</label>
                <div class="readonly-value">{proposalData?.texto_introductorio || 'No especificado'}</div>
            </div>
        </div>

        <!-- Descripci√≥n de la Empresa -->
        <div class="form-section">
            <h3>üè¢ Descripci√≥n de la Empresa</h3>
            <div class="form-group">
                <label>Descripci√≥n de Cloud Pixels</label>
                <div class="readonly-value">{proposalData?.descripcion_empresa || 'No especificada'}</div>
            </div>
        </div>

        <!-- Horarios de Atenci√≥n -->
        <div class="form-section">
            <h3>üïí Horarios de Atenci√≥n</h3>
            <div class="form-group">
                <label>Horarios de atenci√≥n al cliente</label>
                <div class="readonly-value">{proposalData?.horarios_atencion || 'No especificados'}</div>
            </div>
        </div>

        <!-- T√©rminos y Condiciones -->
        <div class="form-section">
            <h3>üìã T√©rminos y Condiciones</h3>
            <div class="form-group">
                <label>T√©rminos y condiciones de la propuesta</label>
                <div class="readonly-value">{proposalData?.terminos_condiciones || 'No especificados'}</div>
            </div>
            <div class="form-group">
                <label>T√©rminos de validez</label>
                <div class="readonly-value">{proposalData?.terminos_validez || 'No especificados'}</div>
            </div>
            <div class="form-group">
                <label>Texto de aceptaci√≥n</label>
                <div class="readonly-value">{proposalData?.texto_aceptacion || 'No especificado'}</div>
            </div>
        </div>
    </div>
) : (
    <!-- Formulario Normal Editable -->
    <form id={formId} class="proposal-form">
        <!-- Informaci√≥n B√°sica del Proyecto -->
        <div class="form-section">
            <h3>üìã Informaci√≥n B√°sica del Proyecto</h3>
            <div class="form-row">
                <div class="form-group">
                    <label for={`${formId}-projectName`}>Nombre del Proyecto *</label>
                    <input type="text" id={`${formId}-projectName`} name="projectName" required 
                           value={proposalData?.nombre_proyecto || ''}>
                </div>
                <div class="form-group">
                    <label for={`${formId}-proposalDate`}>Fecha de Propuesta *</label>
                    <input type="date" id={`${formId}-proposalDate`} name="proposalDate" required 
                           value={proposalData?.fecha_propuesta || ''}>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for={`${formId}-clientName`}>Nombre del Cliente *</label>
                    <input type="text" id={`${formId}-clientName`} name="clientName" required 
                           value={proposalData?.cliente_nombre || ''}>
                </div>
                <div class="form-group">
                    <label for={`${formId}-clientCompany`}>Empresa del Cliente *</label>
                    <input type="text" id={`${formId}-clientCompany`} name="clientCompany" required 
                           value={proposalData?.cliente_empresa || ''}>
                </div>
            </div>
        </div>

        <!-- Resumen Ejecutivo -->
        <div class="form-section">
            <h3>üìä Resumen Ejecutivo</h3>
            <div class="form-group">
                <label for={`${formId}-executiveSummary`}>Descripci√≥n del proyecto y propuesta de valor *</label>
                <textarea id={`${formId}-executiveSummary`} name="executiveSummary" required>{proposalData?.resumen_ejecutivo || ''}</textarea>
            </div>
        </div>

        <!-- Objetivos y Alcance -->
        <div class="form-section">
            <h3>üéØ Objetivos & Alcance</h3>
            <div class="form-group">
                <label for={`${formId}-objectivesScope`}>Objetivos espec√≠ficos y alcance del trabajo *</label>
                <textarea id={`${formId}-objectivesScope`} name="objectivesScope" required>{proposalData?.objetivos_alcance || ''}</textarea>
            </div>
        </div>

        <!-- Servicios -->
        <div class="form-section">
            <h3>üõ†Ô∏è Servicios Incluidos</h3>
            <div class="checkbox-group">
                <div class="checkbox-item">
                    <input type="checkbox" id={`${formId}-service1`} name="services" value="Website Design" 
                           checked={proposalData?.servicios_seleccionados?.includes('Website Design') || false}>
                    <label for={`${formId}-service1`}>Website Design</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id={`${formId}-service2`} name="services" value="Landing Page" 
                           checked={proposalData?.servicios_seleccionados?.includes('Landing Page') || false}>
                    <label for={`${formId}-service2`}>Landing Page</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id={`${formId}-service3`} name="services" value="Logo & Branding" 
                           checked={proposalData?.servicios_seleccionados?.includes('Logo & Branding') || false}>
                    <label for={`${formId}-service3`}>Logo & Branding</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id={`${formId}-service4`} name="services" value="Email Marketing" 
                           checked={proposalData?.servicios_seleccionados?.includes('Email Marketing') || false}>
                    <label for={`${formId}-service4`}>Email Marketing</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id={`${formId}-service5`} name="services" value="SEO Review & Consulting" 
                           checked={proposalData?.servicios_seleccionados?.includes('SEO Review & Consulting') || false}>
                    <label for={`${formId}-service5`}>SEO Review & Consulting</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id={`${formId}-service6`} name="services" value="Ecommerce Site" 
                           checked={proposalData?.servicios_seleccionados?.includes('Ecommerce Site') || false}>
                    <label for={`${formId}-service6`}>Ecommerce Site</label>
                </div>
            </div>
        </div>

        <!-- Entregables -->
        <div class="form-section">
            <h3>üì¶ Entregables</h3>
            <div class="deliverables-container">
                <div id={`${formId}-deliverablesList`} class="deliverables-list">
                    {proposalData?.entregables && Array.isArray(proposalData.entregables) ? 
                        proposalData.entregables.map((entregable: string, index: number) => (
                            <div class="deliverable-item">
                                <input type="text" name="deliverables[]" value={entregable} required>
                                <button type="button" class="btn btn-danger btn-small" data-action="remove-deliverable">‚ùå</button>
                            </div>
                        )) :
                        <div class="deliverable-item">
                            <input type="text" name="deliverables[]" placeholder="Entregable 1" required>
                            <button type="button" class="btn btn-danger btn-small" data-action="remove-deliverable">‚ùå</button>
                        </div>
                    }
                </div>
                <button type="button" class="btn btn-secondary" data-action="add-deliverable">‚ûï Agregar Entregable</button>
            </div>
        </div>

        <!-- Propuesta Econ√≥mica -->
        <div class="form-section">
            <h3>üí∞ Propuesta Econ√≥mica</h3>
            <div class="form-row">
                <div class="form-group">
                    <label for={`${formId}-projectValue`}>Valor del Proyecto *</label>
                    <input type="text" id={`${formId}-projectValue`} name="projectValue" placeholder="$X,XXX" required 
                           value={proposalData?.valor_proyecto || ''}>
                </div>
            </div>
            <div class="form-group">
                <label for={`${formId}-paymentTerms`}>Condiciones de Pago *</label>
                <textarea id={`${formId}-paymentTerms`} name="paymentTerms" placeholder="‚Ä¢ Pago inicial del 50% al aceptar la propuesta&#10;‚Ä¢ Saldo restante al finalizar el proyecto&#10;‚Ä¢ Incluye todos los servicios y entregables definidos" required>{proposalData?.terminos_pago || ''}</textarea>
            </div>
        </div>

        <!-- Informaci√≥n de Contacto -->
        <div class="form-section">
            <h3>üìû Informaci√≥n de Contacto</h3>
            <div class="form-row">
                <div class="form-group">
                    <label for={`${formId}-contactEmail`}>Email de Contacto</label>
                    <input type="email" id={`${formId}-contactEmail`} name="contactEmail" placeholder="tu.correo@cloudpixels.com" 
                           value={proposalData?.contacto_email || ''}>
                </div>
                <div class="form-group">
                    <label for={`${formId}-contactWhatsApp`}>WhatsApp</label>
                    <input type="text" id={`${formId}-contactWhatsApp`} name="contactWhatsApp" placeholder="+XX XXX XXX XXXX" 
                           value={proposalData?.contacto_whatsapp || ''}>
                </div>
            </div>
        </div>

        <!-- Texto Introductorio -->
        <div class="form-section">
            <h3>üìù Texto Introductorio</h3>
            <div class="form-group">
                <label for={`${formId}-introText`}>Texto introductorio de la propuesta</label>
                <textarea id={`${formId}-introText`} name="introText" placeholder="Soluciones creativas para impulsar tu presencia digital con dise√±o, desarrollo, branding y estrategias de marketing.">{proposalData?.texto_introductorio || 'Soluciones creativas para impulsar tu presencia digital con dise√±o, desarrollo, branding y estrategias de marketing.'}</textarea>
            </div>
        </div>

        <!-- Descripci√≥n de la Empresa -->
        <div class="form-section">
            <h3>üè¢ Descripci√≥n de la Empresa</h3>
            <div class="form-group">
                <label for={`${formId}-companyDescription`}>Descripci√≥n de Cloud Pixels</label>
                <textarea id={`${formId}-companyDescription`} name="companyDescription" placeholder="Con m√°s de 9 a√±os de experiencia, Cloud Pixels es un equipo global...">{proposalData?.descripcion_empresa || 'Con m√°s de 9 a√±os de experiencia, Cloud Pixels es un equipo global con oficinas en Honduras, Estados Unidos, Estonia y Panam√°. Combinamos talento de dise√±o y desarrollo de todo el mundo para crear soluciones digitales excepcionales y escalables.'}</textarea>
            </div>
        </div>

        <!-- Horarios de Atenci√≥n -->
        <div class="form-section">
            <h3>üïí Horarios de Atenci√≥n</h3>
            <div class="form-group">
                <label for={`${formId}-attentionHours`}>Horarios de atenci√≥n al cliente</label>
                <textarea id={`${formId}-attentionHours`} name="attentionHours" placeholder="Nuestro equipo est√° disponible...">{proposalData?.horarios_atencion || 'Nuestro equipo est√° disponible de lunes a viernes de 9:00 a.m. a 6:00 p.m. (aplican d√≠as feriados). Para consultas fuera de este horario, responderemos al siguiente d√≠a laboral.'}</textarea>
            </div>
        </div>

        <!-- T√©rminos y Condiciones -->
        <div class="form-section">
            <h3>üìã T√©rminos y Condiciones</h3>
            <div class="form-group">
                <label for={`${formId}-termsConditions`}>T√©rminos y condiciones de la propuesta</label>
                <textarea id={`${formId}-termsConditions`} name="termsConditions" placeholder="Al aceptar esta propuesta...">{proposalData?.terminos_condiciones || 'Al aceptar esta propuesta, el cliente se compromete a abonar un anticipo del 50% para iniciar el proyecto. El saldo restante se pagar√° al finalizar, antes del lanzamiento.'}</textarea>
            </div>
            <div class="form-group">
                <label for={`${formId}-validityTerms`}>T√©rminos de validez</label>
                <textarea id={`${formId}-validityTerms`} name="validityTerms" placeholder="Esta propuesta es v√°lida...">{proposalData?.terminos_validez || 'Esta propuesta es v√°lida durante 30 d√≠as a partir de la fecha de emisi√≥n. Los servicios de mantenimiento, hosting o funcionalidades adicionales no mencionados aqu√≠ se considerar√°n extras opcionales.'}</textarea>
            </div>
            <div class="form-group">
                <label for={`${formId}-acceptanceText`}>Texto de aceptaci√≥n</label>
                <textarea id={`${formId}-acceptanceText`} name="acceptanceText" placeholder="¬øListo para comenzar?">{proposalData?.texto_aceptacion || '¬øListo para comenzar? Haz clic en el bot√≥n de abajo para aceptar la propuesta. Podr√°s firmar digitalmente y realizar el pago inicial.'}</textarea>
            </div>
        </div>

        <!-- Bot√≥n de env√≠o -->
        {mode === 'create' ? (
            <button type="submit" class="btn btn-primary">üöÄ Generar Propuesta</button>
        ) : (
            <button type="submit" class="btn btn-primary">üíæ Actualizar Propuesta</button>
        )}
    </form>
)}
