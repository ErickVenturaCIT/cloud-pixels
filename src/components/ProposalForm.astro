---
export interface Props {
    mode: 'create' | 'edit';
    proposalData?: any;
    formId: string;
}

const { mode, proposalData, formId } = Astro.props;
---

<form id={formId} class="proposal-form">
    <!-- Informaci√≥n B√°sica del Proyecto -->
    <div class="form-section">
        <h3>üìã Informaci√≥n B√°sica del Proyecto</h3>
        <div class="form-row">
            <div class="form-group">
                <label for={`${formId}-projectName`}>Nombre del Proyecto *</label>
                <input type="text" id={`${formId}-projectName`} name="nombre_proyecto" required 
                       value={proposalData?.nombre_proyecto || ''}>
            </div>
            <div class="form-group">
                <label for={`${formId}-proposalDate`}>Fecha de Propuesta *</label>
                <input type="date" id={`${formId}-proposalDate`} name="fecha_propuesta" required 
                       value={proposalData?.fecha_propuesta || ''}>
            </div>
        </div>
        <div class="form-row">
            <div class="form-group">
                <label for={`${formId}-clientName`}>Nombre del Cliente *</label>
                <input type="text" id={`${formId}-clientName`} name="cliente_nombre" required 
                       value={proposalData?.cliente_nombre || ''}>
            </div>
            <div class="form-group">
                <label for={`${formId}-clientCompany`}>Empresa del Cliente *</label>
                <input type="text" id={`${formId}-clientCompany`} name="cliente_empresa" required 
                       value={proposalData?.cliente_empresa || ''}>
            </div>
        </div>
        
        <!-- Logo de la Empresa -->
        <div class="form-section logo-upload-section">
            <h4>üè¢ Logo de la Empresa</h4>
            <p class="logo-description">Sube el logo oficial de la empresa para personalizar la propuesta</p>
            <div id="logo-uploader-container">
                <!-- El componente ImageUploader se renderizar√° aqu√≠ -->
            </div>
            <input type="hidden" id={`${formId}-companyLogoUrl`} name="company_logo_url" value={proposalData?.company_logo_url || ''}>
            <div id="logo-preview" class="logo-preview" style="display: none;">
                <img id="logo-preview-image" alt="Logo de la empresa" />
                <button type="button" class="btn btn-small btn-danger" id="remove-logo-btn">üóëÔ∏è Eliminar Logo</button>
            </div>
        </div>
    </div>

    <!-- Resumen Ejecutivo -->
    <div class="form-section">
        <h3>üìä Resumen Ejecutivo</h3>
        <div class="form-group">
            <label for={`${formId}-executiveSummary`}>Descripci√≥n del proyecto y propuesta de valor *</label>
            <textarea id={`${formId}-executiveSummary`} name="resumen_ejecutivo" required>{proposalData?.resumen_ejecutivo || ''}</textarea>
        </div>
    </div>

    <!-- Objetivos y Alcance -->
    <div class="form-section">
        <h3>üéØ Objetivos & Alcance</h3>
        <div class="form-group">
            <label for={`${formId}-objectivesScope`}>Objetivos espec√≠ficos y alcance del trabajo *</label>
            <textarea id={`${formId}-objectivesScope`} name="objetivos_alcance" required>{proposalData?.objetivos_alcance || ''}</textarea>
        </div>
    </div>

    <!-- Servicios -->
    <div class="form-section">
        <h3>üõ†Ô∏è Servicios Incluidos</h3>
        <div class="checkbox-group">
            <div class="checkbox-item">
                <input type="checkbox" id={`${formId}-service1`} name="servicios" value="Website Design" 
                       checked={proposalData?.servicios_seleccionados?.includes('Website Design') || false}>
                <label for={`${formId}-service1`}>Website Design</label>
            </div>
            <div class="checkbox-item">
                <input type="checkbox" id={`${formId}-service2`} name="servicios" value="Landing Page" 
                       checked={proposalData?.servicios_seleccionados?.includes('Landing Page') || false}>
                <label for={`${formId}-service2`}>Landing Page</label>
            </div>
            <div class="checkbox-item">
                <input type="checkbox" id={`${formId}-service3`} name="servicios" value="Logo & Branding" 
                       checked={proposalData?.servicios_seleccionados?.includes('Logo & Branding') || false}>
                <label for={`${formId}-service3`}>Logo & Branding</label>
            </div>
            <div class="checkbox-item">
                <input type="checkbox" id={`${formId}-service4`} name="servicios" value="Email Marketing" 
                       checked={proposalData?.servicios_seleccionados?.includes('Email Marketing') || false}>
                <label for={`${formId}-service4`}>Email Marketing</label>
            </div>
            <div class="checkbox-item">
                <input type="checkbox" id={`${formId}-service5`} name="servicios" value="SEO Review & Consulting" 
                       checked={proposalData?.servicios_seleccionados?.includes('SEO Review & Consulting') || false}>
                <label for={`${formId}-service5`}>SEO Review & Consulting</label>
            </div>
            <div class="checkbox-item">
                <input type="checkbox" id={`${formId}-service6`} name="servicios" value="Ecommerce Site" 
                       checked={proposalData?.servicios_seleccionados?.includes('Ecommerce Site') || false}>
                <label for={`${formId}-service6`}>Ecommerce Site</label>
            </div>
        </div>
    </div>

    <!-- Entregables -->
    <div class="form-section">
        <h3>üì¶ Entregables</h3>
        <div class="deliverables-container">
            <div id="entregablesContainer" class="deliverables-list">
                {proposalData?.entregables && Array.isArray(proposalData.entregables) ? 
                    proposalData.entregables.map((entregable: string, index: number) => (
                        <div class="deliverable-item">
                            <input type="text" name="deliverables[]" value={entregable} required>
                            <button type="button" class="btn btn-danger btn-small" data-action="remove-deliverable">‚ùå</button>
                        </div>
                    )) :
                    <div class="deliverable-item">
                        <input type="text" name="deliverables[]" placeholder="Entregable 1" required>
                        <button type="button" class="btn btn-danger btn-small" data-action="remove-deliverable">‚ùå</button>
                    </div>
                }
            </div>
            <button type="button" class="btn btn-secondary" data-action="add-deliverable">‚ûï Agregar Entregable</button>
        </div>
    </div>

    <!-- Propuesta Econ√≥mica -->
    <div class="form-section">
        <h3>üí∞ Propuesta Econ√≥mica</h3>
        <div class="form-row">
            <div class="form-group">
                <label for={`${formId}-projectValue`}>Valor del Proyecto *</label>
                <input type="text" id={`${formId}-projectValue`} name="valor_proyecto" placeholder="$X,XXX" required 
                       value={proposalData?.valor_proyecto || ''}>
            </div>
        </div>
        <div class="form-group">
            <label for={`${formId}-paymentTerms`}>Condiciones de Pago *</label>
            <textarea id={`${formId}-paymentTerms`} name="terminos_pago" placeholder="‚Ä¢ Pago inicial del 50% al aceptar la propuesta&#10;‚Ä¢ Saldo restante al finalizar el proyecto&#10;‚Ä¢ Incluye todos los servicios y entregables definidos" required>{proposalData?.terminos_pago || ''}</textarea>
        </div>
    </div>

    <!-- Informaci√≥n de Contacto -->
    <div class="form-section">
        <h3>üìû Informaci√≥n de Contacto</h3>
        <div class="form-row">
            <div class="form-group">
                <label for={`${formId}-contactEmail`}>Email de Contacto</label>
                <input type="email" id={`${formId}-contactEmail`} name="contacto_email" placeholder="tu.correo@cloudpixels.com" 
                       value={proposalData?.contacto_email || ''}>
            </div>
            <div class="form-group">
                <label for={`${formId}-contactWhatsApp`}>WhatsApp</label>
                <input type="text" id={`${formId}-contactWhatsApp`} name="contacto_whatsapp" placeholder="+XX XXX XXX XXXX" 
                       value={proposalData?.contacto_whatsapp || ''}>
            </div>
        </div>
    </div>

    <!-- Texto Introductorio -->
    <div class="form-section">
        <h3>üìù Texto Introductorio</h3>
        <div class="form-group">
            <label for={`${formId}-introText`}>Texto introductorio de la propuesta</label>
            <textarea id={`${formId}-introText`} name="texto_introductorio" placeholder="Soluciones creativas para impulsar tu presencia digital con dise√±o, desarrollo, branding y estrategias de marketing.">{proposalData?.texto_introductorio || 'Soluciones creativas para impulsar tu presencia digital con dise√±o, desarrollo, branding y estrategias de marketing.'}</textarea>
        </div>
    </div>

    <!-- Descripci√≥n de la Empresa -->
    <div class="form-section">
        <h3>üè¢ Descripci√≥n de la Empresa</h3>
        <div class="form-group">
            <label for={`${formId}-companyDescription`}>Descripci√≥n de Cloud Pixels</label>
            <textarea id={`${formId}-companyDescription`} name="descripcion_empresa" placeholder="Con m√°s de 9 a√±os de experiencia, Cloud Pixels es un equipo global...">{proposalData?.descripcion_empresa || 'Con m√°s de 9 a√±os de experiencia, Cloud Pixels es un equipo global con oficinas en Honduras, Estados Unidos, Estonia y Panam√°. Combinamos talento de dise√±o y desarrollo de todo el mundo para crear soluciones digitales excepcionales y escalables.'}</textarea>
        </div>
    </div>

    <!-- Horarios de Atenci√≥n -->
    <div class="form-section">
        <h3>üïí Horarios de Atenci√≥n</h3>
        <div class="form-group">
            <label for={`${formId}-attentionHours`}>Horarios de atenci√≥n al cliente</label>
            <textarea id={`${formId}-attentionHours`} name="horarios_atencion" placeholder="Nuestro equipo est√° disponible...">{proposalData?.horarios_atencion || 'Nuestro equipo est√° disponible de lunes a viernes de 9:00 a.m. a 6:00 p.m. (aplican d√≠as feriados). Para consultas fuera de este horario, responderemos al siguiente d√≠a laboral.'}</textarea>
        </div>
    </div>

    <!-- T√©rminos y Condiciones -->
    <div class="form-section">
        <h3>üìã T√©rminos y Condiciones</h3>
        <div class="form-group">
            <label for={`${formId}-termsConditions`}>T√©rminos y condiciones de la propuesta</label>
            <textarea id={`${formId}-termsConditions`} name="terminos_condiciones" placeholder="Al aceptar esta propuesta...">{proposalData?.terminos_condiciones || 'Al aceptar esta propuesta, el cliente se compromete a abonar un anticipo del 50% para iniciar el proyecto. El saldo restante se pagar√° al finalizar, antes del lanzamiento.'}</textarea>
        </div>
        <div class="form-group">
            <label for={`${formId}-validityTerms`}>T√©rminos de validez</label>
            <textarea id={`${formId}-validityTerms`} name="terminos_validez" placeholder="Esta propuesta es v√°lida...">{proposalData?.terminos_validez || 'Esta propuesta es v√°lida durante 30 d√≠as a partir de la fecha de emisi√≥n. Los servicios de mantenimiento, hosting o funcionalidades adicionales no mencionados aqu√≠ se considerar√°n extras opcionales.'}</textarea>
        </div>
        <div class="form-group">
            <label for={`${formId}-acceptanceText`}>Texto de aceptaci√≥n</label>
            <textarea id={`${formId}-acceptanceText`} name="texto_aceptacion" placeholder="¬øListo para comenzar?">{proposalData?.texto_aceptacion || '¬øListo para comenzar? Haz clic en el bot√≥n de abajo para aceptar la propuesta. Podr√°s firmar digitalmente y realizar el pago inicial.'}</textarea>
        </div>
    </div>

    <!-- Bot√≥n de env√≠o -->
    {mode === 'create' ? (
        <button type="submit" class="btn btn-primary">üöÄ Generar Propuesta (Se abrir√° autom√°ticamente)</button>
    ) : (
        <button type="submit" class="btn btn-primary">üíæ Actualizar Propuesta</button>
    )}
</form>

<style>
    .logo-upload-section {
        margin-top: 1.5rem;
        padding: 1.5rem;
        background: #f8f9fa;
        border-radius: 8px;
        border-left: 4px solid #F27E2A;
    }

    .logo-upload-section h4 {
        margin: 0 0 0.5rem 0;
        color: #08002B;
        font-size: 1.1rem;
        font-weight: 600;
    }

    .logo-description {
        margin: 0 0 1rem 0;
        color: #6b7280;
        font-size: 0.875rem;
        line-height: 1.4;
    }

    .logo-preview {
        margin-top: 1rem;
        text-align: center;
        padding: 1rem;
        background: white;
        border-radius: 6px;
        border: 1px solid #e5e7eb;
    }

    .logo-preview img {
        max-width: 150px;
        max-height: 100px;
        border-radius: 4px;
        margin-bottom: 0.5rem;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    #remove-logo-btn {
        font-size: 0.75rem;
        padding: 0.25rem 0.5rem;
    }

    /* Estilos para el componente ImageUploader integrado */
    .logo-uploader-container {
        margin-bottom: 1rem;
    }

    .logo-uploader-container .image-uploader {
        max-width: 100%;
        margin: 0;
    }

    .logo-uploader-container .upload-header h3 {
        font-size: 1rem;
        margin-bottom: 0.25rem;
    }

    .logo-uploader-container .upload-description {
        font-size: 0.75rem;
        margin-bottom: 0.25rem;
    }

    .logo-uploader-container .upload-requirements {
        font-size: 0.7rem;
    }

    .logo-uploader-container .upload-area {
        padding: 1.5rem;
    }

    .logo-uploader-container .upload-icon {
        margin-bottom: 0.5rem;
    }

    .logo-uploader-container .upload-text {
        font-size: 1rem;
    }

    .logo-uploader-container .upload-subtext {
        font-size: 0.8rem;
    }
</style>
